<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Media Gallery</title>
  <style>
    /* Base */
    body { font-family:'Helvetica Neue',Arial,sans-serif; margin:0; background:#141414; color:#fff; }
    .header { position:sticky; top:0; display:flex; justify-content:flex-end; padding:16px; background:#1f1f1f; z-index:100; }
    .search-btn { background:#333; border:none; width:40px; height:40px; border-radius:50%; font-size:20px; color:#fff; cursor:pointer; }
    /* Slide-out Search Panel */
    #search-panel { position:fixed; top:0; right:-100%; width:300px; height:100vh; background:#000; box-shadow:-2px 0 8px rgba(0,0,0,0.7); transition:right .3s ease; padding:20px; z-index:200; overflow-y:auto; }
    #search-panel.open { right:0; }
    #search-panel header { display:flex; justify-content:space-between; align-items:center; }
    #search-panel h3 { margin:0; color:#e50914; }
    #search-panel #close-search { background:none; border:none; font-size:24px; color:#fff; cursor:pointer; }
    #search-input { width:100%; padding:10px; font-size:16px; border:none; border-radius:4px; margin:16px 0; background:#333; color:#fff; }
    #search-results { display:flex; flex-wrap:wrap; gap:12px; }
    /* Main Slider */
    .main-slider { position:relative; width:100%; overflow:hidden; }
    .main-slider .track { display:flex; transition:transform .5s ease; }
    .main-slider .card { flex:0 0 100%; aspect-ratio:16/9; position:relative; border-radius:12px; overflow:hidden; }
    .main-slider img { width:100%; height:100%; object-fit:cover; }
    .main-slider .title { position:absolute; bottom:0; width:100%; padding:12px; background:rgba(0,0,0,0.6); font-size:18px; text-align:center; }
    /* Small Sliders */
    .row { margin:30px 0; }
    .row-title { font-size:18px; margin:0 0 12px; text-transform:uppercase; color:#ddd; }
    .small-slider { display:flex; overflow-x:auto; gap:12px; padding-bottom:8px; }
    .small-slider::-webkit-scrollbar { height:6px; }
    .small-slider::-webkit-scrollbar-thumb { background:#555; border-radius:3px; }
    .small-card { position:relative; flex:0 0 180px; aspect-ratio:16/9; border-radius:8px; overflow:hidden; cursor:pointer; }
    .small-card img { width:100%; height:100%; object-fit:cover; }
    .small-card .title { position:absolute; bottom:0; width:100%; padding:6px; background:rgba(0,0,0,0.5); font-size:14px; text-align:center; }
    /* Detail View */
    #detail-view { display:none; padding:20px; max-width:600px; margin:40px auto; background:#1f1f1f; border-radius:12px; }
    #back-to-gallery { background:none; border:none; color:#e50914; font-size:16px; cursor:pointer; }
    #detail-thumb { width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:8px; margin:20px 0; }
    #detail-title { margin:0; font-size:22px; }
    .actions { margin-top:20px; text-align:center; }
    .btn { background-color:#e50914; color:#fff; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; font-size:16px; }
    #open-link { display:none; margin-top:10px; color:#1a73e8; cursor:pointer; text-decoration:underline; }
  </style>
</head>
<body>
  <div class="header">
    <button id="open-search" class="search-btn">üîç</button>
  </div>

  <!-- Search Panel -->
  <div id="search-panel">
    <header>
      <h3>Search</h3>
      <button id="close-search">‚úñ</button>
    </header>
    <input id="search-input" type="text" placeholder="Search titles..." />
    <div id="search-results"></div>
  </div>

  <!-- Main Slider -->
  <div class="main-slider" id="main-slider">
    <div class="track" id="main-track">
      {% for v in videos %}
      <div class="card" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
        <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
        <div class="title">{{ v.title }}</div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Recommendation Rows -->
  <div class="row">
    <h2 class="row-title">Recommended</h2>
    <div class="small-slider" id="rec-slider">
      {% for v in videos %}
      <div class="small-card" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
        <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
        <div class="title">{{ v.title }}</div>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="row">
    <h2 class="row-title">New Releases</h2>
    <div class="small-slider" id="new-slider">
      {% for v in videos %}
      <div class="small-card" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
        <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
        <div class="title">{{ v.title }}</div>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="row">
    <h2 class="row-title">Trending</h2>
    <div class="small-slider" id="trend-slider">
      {% for v in videos %}
      <div class="small-card" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
        <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
        <div class="title">{{ v.title }}</div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Detail View -->
  <div id="detail-view">
    <button id="back-to-gallery">‚Üê Back to Gallery</button>
    <img id="detail-thumb" alt="">
    <h2 id="detail-title"></h2>
    <div class="actions">
      <button id="detail-get" class="btn">Get File</button>
      <div id="open-link">Open Link</div>
    </div>
  </div>

  <script>
    const BOT_USERNAME = '{{ bot_username }}';
    // Search panel toggles
    const panel = document.getElementById('search-panel');
    document.getElementById('open-search').onclick = () => panel.classList.add('open');
    document.getElementById('close-search').onclick = () => panel.classList.remove('open');

    // Populate search-results initially
    const allCards = Array.from(document.querySelectorAll('.small-card, .card')).map(c => {
      return {
        thumb: c.dataset.thumb,
        title: c.dataset.title,
        key: c.dataset.key
      };
    });
    const resultsContainer = document.getElementById('search-results');
    function renderResults(list) {
      resultsContainer.innerHTML = '';
      list.forEach(v => {
        const div = document.createElement('div');
        div.className = 'small-card';
        div.dataset.thumb = v.thumb;
        div.dataset-title = v.title;
        div.dataset-key = v.key;
        div.innerHTML = `<img src="${v.thumb}" alt="${v.title}"><div class="title">${v.title}</div>`;
        resultsContainer.append(div);
      });
    }
    renderResults(allCards);
    // Filter on input
    document.getElementById('search-input').addEventListener('input', e => {
      const term = e.target.value.toLowerCase();
      renderResults(allCards.filter(v => v.title.toLowerCase().includes(term)));
    });

    // Main slider auto
    let idx = 0;
    const mTrack = document.getElementById('main-track');
    const mCards = mTrack.children;
    function showMain(i) {
      idx = (i + mCards.length) % mCards.length;
      mTrack.style.transform = `translateX(-${idx * 100}%)`;
    }
    let mainInterval = setInterval(() => showMain(idx + 1), 5000);
    document.getElementById('main-slider').addEventListener('mouseenter', () => clearInterval(mainInterval));
    document.getElementById('main-slider').addEventListener('mouseleave', () => mainInterval = setInterval(() => showMain(idx + 1), 5000));

    // Detail view handling
    const detailView = document.getElementById('detail-view');
    const backBtn = document.getElementById('back-to-gallery');
    const dThumb = document.getElementById('detail-thumb');
    const dTitle = document.getElementById('detail-title');
    const dGet = document.getElementById('detail-get');
    const dLink = document.getElementById('open-link');
    document.body.addEventListener('click', e => {
      const card = e.target.closest('.card, .small-card'); if (!card) return;
      const {thumb, title, key} = card.dataset;
      dThumb.src = thumb; dThumb.alt = title;
      dTitle.textContent = title;
      dGet.style.display = 'inline-block'; dGet.disabled = false;
      dLink.style.display = 'none';
      dGet.textContent = 'Get File';
      dGet.onclick = () => startTimer(key);
      document.querySelectorAll('.main-slider, .row, .header').forEach(el => el.style.display = 'none');
      detailView.style.display = 'block';
      panel.classList.remove('open');
    });
    backBtn.onclick = () => {
      detailView.style.display = 'none';
      document.querySelectorAll('.main-slider, .row, .header').forEach(el => el.style.display = 'block');
    };
    function startTimer(key) {
      dGet.disabled = true;
      let c = 10; dGet.textContent = `Wait ${c}s...`;
      const iv = setInterval(() => {
        c--;
        if (c <= 0) {
          clearInterval(iv);
          dGet.style.display = 'none';
          dLink.style.display = 'block';
          dLink.onclick = () => window.open(`https://t.me/${BOT_USERNAME}?start=${key}`,'_blank');
        } else {
          dGet.textContent = `Wait ${c}s...`;
        }
      }, 1000);
    }
  </script>
</body>
</html>
