<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Video</title>
    <style>
        /* [Your existing CSS remains unchanged] */
    </style>
    <!-- Load the ad script and define the slot -->
    <script type="module" src="https://securepubads.shareus.io/scripts/tag/js/gpt.js"></script>
    <script>
        window._shareustag = window._shareustag || {cmd:[]};
        _shareustag.cmd.push(function() {
            _shareustag.defineSlot('/shareus-admanager/3049258825/cevFiS93lz/Banner4', ["Responsive"], 'shareus-admanager-3049258825-cevFiS93lz');
        });
    </script>
</head>
<body>
    <header>
        <div class="logo">Prime Video</div>
        <div class="search">
            <button class="search-btn">üîç</button>
        </div>
    </header>

    <section class="more-files">
        <h2>More Files</h2>
        <div class="vertical-scroll" id="more-files-slider">
            {% for v in videos %}
            <div class="thumbnail" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
                <div class="image-container">
                    <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
                </div>
                <div class="title">{{ v.title }}</div>
            </div>
            {% endfor %}
        </div>
    </section>

    <div id="detail-page">
        <div id="detail-content">
            <img id="detail-thumb" src="" alt="">
            <h2 id="detail-title"></h2>
            <button class="btn" id="get-file">Get File</button>
            <div id="timer"></div>
            <button class="btn" id="open-link" style="display:none;">Open File</button>
            <button class="btn secondary" id="close-detail">Close</button>
            <div id="shareus-admanager-3049258825-cevFiS93lz" class="ad-unit"></div>
        </div>
    </div>

    <div id="search-overlay">
        <input type="text" id="overlay-search" placeholder="Search by title...">
        <div id="search-results"></div>
        <button class="btn secondary" id="close-search">Close</button>
    </div>

    <script>
        const BOT_USERNAME = '{{ bot_username }}';

        // Collect video data
        const videos = Array.from(document.querySelectorAll('.hero-slide, .thumbnail')).map(item => ({
            thumb: item.getAttribute('data-thumb'),
            title: item.getAttribute('data-title'),
            key: item.getAttribute('data-key')
        }));

        // Thumbnail Click
        document.body.addEventListener('click', e => {
            const item = e.target.closest('.hero-slide, .thumbnail, .watch-now');
            if (!item) return;
            const thumb = item.getAttribute('data-thumb');
            const title = item.getAttribute('data-title');
            const key = item.getAttribute('data-key');
            document.getElementById('detail-thumb').src = thumb;
            document.getElementById('detail-title').textContent = title;
            document.getElementById('get-file').style.display = 'inline-block';
            document.getElementById('open-link').style.display = 'none';
            document.getElementById('get-file').disabled = false;
            document.getElementById('timer').textContent = '';
            document.getElementById('get-file').onclick = () => startTimer(key);
            document.getElementById('detail-page').classList.add('open');
            // Trigger ad display when the overlay opens
            if (window._shareustag) {
                _shareustag.cmd.push(function() {
                    _shareustag.display('shareus-admanager-3049258825-cevFiS93lz');
                });
            }
        });

        // Close Detail
        document.getElementById('close-detail').onclick = () => {
            document.getElementById('detail-page').classList.remove('open');
        };

        // Timer for Telegram Link
        function startTimer(key) {
            const btn = document.getElementById('get-file');
            const link = document.getElementById('open-link');
            const timerEl = document.getElementById('timer');
            btn.disabled = true;
            let c = 5;
            timerEl.textContent = `Wait ${c}s...`;
            const iv = setInterval(() => {
                c--;
                if (c <= 0) {
                    clearInterval(iv);
                    btn.style.display = 'none';
                    link.style.display = 'block';
                    timerEl.textContent = '';
                    link.onclick = () => window.open(`https://t.me/${BOT_USERNAME}?start=${key}`, '_blank');
                } else {
                    timerEl.textContent = `Wait ${c}s...`;
                }
            }, 1000);
        }

        // [Your existing search functionality remains unchanged]
    </script>
</body>
</html>
