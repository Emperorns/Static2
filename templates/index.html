<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Video</title>
    <style>
        /* Base Styles */
        :root {
            --bg: #0f171e;
            --fg: #fff;
            --accent: #00a8e1;
            --radius: 6px;
            --gap: 15px;
            --transition: 0.3s;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--fg); font-family: 'Helvetica Neue', Arial, sans-serif; }
        a { color: inherit; text-decoration: none; }

        /* Header */
        header {
            display: flex; align-items: center; justify-content: center;
            padding: 10px 12px; background: var(--bg);
            position: sticky; top: 0; z-index: 100;
        }
        .logo { font-size: 1.2rem; font-weight: bold; color: var(--accent); text-align: center; }
        .search { position: absolute; right: 12px; display: flex; align-items: center; }
        .search-btn { background: none; border: none; color: var(--fg); font-size: 1rem; cursor: pointer; }

        /* More Files Section */
        .more-files {
            margin: 15px 12px;
        }
        .more-files h2 { font-size: 1rem; margin-bottom: 10px; }
        .vertical-scroll {
            display: flex; flex-direction: column; gap: var(--gap);
            overflow-y: auto; padding-bottom: 20px; overflow: visible;
        }
        .vertical-scroll .thumbnail {
            min-width: unset; width: 90vw; margin: 0 auto;
        }
        .vertical-scroll .image-container { aspect-ratio: 16/9; }
        .vertical-scroll::-webkit-scrollbar { width: 4px; }
        .vertical-scroll::-webkit-scrollbar-thumb { background: #555; border-radius: 2px; }

        /* Detail Overlay */
        #detail-page {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; flex-direction: column; align-items: center;
            justify-content: center; padding: 20px; z-index: 200;
        }
        #detail-page.open { display: flex; }
        #detail-content {
            background: var(--bg); padding: 20px; border-radius: var(--radius);
            max-width: 90%; width: 350px; text-align: center;
        }
        #detail-content img { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: var(--radius); margin-bottom: 12px; }
        .btn {
            margin-top: 10px; padding: 6px 12px; border: none;
            background: var(--accent); color: var(--fg); border-radius: var(--radius);
            cursor: pointer; font-size: 0.8rem;
        }
        .btn.secondary { background: transparent; border: 1px solid var(--fg); }
        #timer { margin-top: 6px; font-size: 0.8rem; }
        .ad-unit {
            margin: 10px auto; max-width: 320px; height: 100px;
            background: #333; display: flex; align-items: center; justify-content: center;
            border-radius: var(--radius); font-size: 0.8rem;
        }

        /* Search Overlay */
        #search-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; flex-direction: column; padding: 20px; z-index: 150;
        }
        #search-overlay.open { display: flex; }
        #search-overlay input {
            padding: 6px; margin-bottom: 12px; border: none;
            background: #333; color: var(--fg); border-radius: var(--radius);
            font-size: 0.8rem;
        }
        #search-results {
            flex: 1; overflow-y: auto; display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: var(--gap);
        }
        #search-results .thumbnail { width: 100%; }
        #search-results .image-container { aspect-ratio: 16/9; }
    </style>
    <!-- Load the ad script and define the slot -->
    <script type="module" src="https://securepubads.shareus.io/scripts/tag/js/gpt.js"></script>
    <script>
        window._shareustag = window._shareustag || {cmd:[]};
        _shareustag.cmd.push(function() {
            _shareustag.defineSlot(
                '/shareus-admanager/3049258825/cevFiS93lz/Banner4',
                ["Responsive"],
                'shareus-admanager-3049258825-cevFiS93lz'
            );
        });
    </script>
</head>
<body>
    <header>
        <div class="logo">Prime Video</div>
        <div class="search">
            <button class="search-btn">üîç</button>
        </div>
    </header>

    <section class="more-files">
        <h2>More Files</h2>
        <div class="vertical-scroll" id="more-files-slider">
            {% for v in videos %}
            <div class="thumbnail" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
                <div class="image-container">
                    <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
                </div>
                <div class="title">{{ v.title }}</div>
            </div>
            {% endfor %}
        </div>
    </section>

    <div id="detail-page">
        <div id="detail-content">
            <img id="detail-thumb" src="" alt="">
            <h2 id="detail-title"></h2>
            <button class="btn" id="get-file">Get File</button>
            <div id="timer"></div>
            <button class="btn secondary" id="close-detail">Close</button>
            <div id="shareus-admanager-3049258825-cevFiS93lz" class="ad-unit"></div>
        </div>
    </div>

    <div id="search-overlay">
        <input type="text" id="overlay-search" placeholder="Search by title...">
        <div id="search-results"></div>
        <button class="btn secondary" id="close-search">Close</button>
    </div>

    <script>
        const BOT_USERNAME = '{{ bot_username }}';

        // Collect video data
        const videos = Array.from(document.querySelectorAll('.thumbnail')).map(item => ({
            thumb: item.getAttribute('data-thumb'),
            title: item.getAttribute('data-title'),
            key: item.getAttribute('data-key')
        }));

        // Thumbnail Click ‚Üí Detail Overlay
        document.body.addEventListener('click', e => {
            const item = e.target.closest('.thumbnail');
            if (!item) return;
            const thumb = item.getAttribute('data-thumb');
            const title = item.getAttribute('data-title');
            const key = item.getAttribute('data-key');
            document.getElementById('detail-thumb').src = thumb;
            document.getElementById('detail-title').textContent = title;
            document.getElementById('get-file').onclick = () => {
                window.location = `/file/${key}`;
            };
            document.getElementById('detail-page').classList.add('open');
            if (window._shareustag) {
                _shareustag.cmd.push(() => {
                    _shareustag.display('shareus-admanager-3049258825-cevFiS93lz');
                });
            }
        });

        // Close Detail Overlay
        document.getElementById('close-detail').onclick = () => {
            document.getElementById('detail-page').classList.remove('open');
        };

        // Search Functionality
        document.querySelector('.search-btn').onclick = () => {
            document.getElementById('search-overlay').classList.add('open');
            document.getElementById('overlay-search').focus();
        };
        document.getElementById('close-search').onclick = () => {
            document.getElementById('search-overlay').classList.remove('open');
            document.getElementById('overlay-search').value = '';
            document.getElementById('search-results').innerHTML = '';
        };
        document.getElementById('overlay-search').oninput = () => {
            const term = document.getElementById('overlay-search').value.toLowerCase();
            const results = videos.filter(v => v.title.toLowerCase().includes(term));
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';
            results.forEach(v => {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'thumbnail';
                thumbnail.setAttribute('data-thumb', v.thumb);
                thumbnail.setAttribute('data-title', v.title);
                thumbnail.setAttribute('data-key', v.key);
                thumbnail.innerHTML = `
                    <div class="image-container">
                        <img src="${v.thumb}" alt="${v.title}">
                    </div>
                    <div class="title">${v.title}</div>
                `;
                resultsContainer.appendChild(thumbnail);
            });
        };
    </script>
</body>
</html>
