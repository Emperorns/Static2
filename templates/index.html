<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Video</title>
    <style>
        /* Base Styles */
        :root {
            --bg: #0f171e;
            --fg: #fff;
            --accent: #00a8e1;
            --radius: 6px;
            --gap: 15px;
            --transition: 0.3s;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--fg); font-family: 'Helvetica Neue', Arial, sans-serif; }
        a { color: inherit; text-decoration: none; }

        /* Header */
        header {
            display: flex; align-items: center; justify-content: center;
            padding: 10px 12px; background: var(--bg);
            position: sticky; top: 0; z-index: 100;
        }
        .logo { font-size: 1.2rem; font-weight: bold; color: var(--accent); text-align: center; }
        .search { position: absolute; right: 12px; display: flex; align-items: center; }
        .search-btn { background: none; border: none; color: var(--fg); font-size: 1rem; cursor: pointer; }

        /* Hero Section */
        .hero {
            position: relative; width: 100%; aspect-ratio: 16/9;
            overflow: hidden; border-radius: var(--radius); margin: 12px 0;
        }
        .hero .track {
            display: flex; transition: transform 0.5s ease;
        }
        .hero-slide {
            flex: 0 0 100%; display: flex; flex-direction: column;
            align-items: center; border-radius: var(--radius); overflow: hidden;
        }
        .hero-slide .image-container {
            width: 100%; height: 100%; aspect-ratio: 16/9; position: relative;
        }
        .hero-slide img {
            width: 100%; height: 100%; object-fit: cover;
            border-radius: var(--radius);
        }
        .hero-slide .watch-now {
            position: absolute; bottom: 10px; right: 10px;
            padding: 6px 12px; border: none;
            background: var(--accent); color: var(--fg); border-radius: var(--radius);
            cursor: pointer; font-size: 0.8rem;
        }
        .hero-content {
            width: 100%; background: rgba(0,0,0,0.7); padding: 12px;
            text-align: center;
        }
        .hero-content h1 {
            font-size: 1.2rem; margin-bottom: 6px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .hero-content p { font-size: 0.8rem; margin-bottom: 8px; }

        /* Content Sections */
        .content-section { margin: 15px 12px; }
        .content-section h2 { font-size: 1rem; margin-bottom: 10px; }
        .scroll-container {
            overflow-x: auto; white-space: nowrap; scroll-behavior: smooth;
            display: flex; gap: var(--gap); padding-bottom: 8px;
        }
        .scroll-container::-webkit-scrollbar { height: 4px; }
        .scroll-container::-webkit-scrollbar-thumb { background: #555; border-radius: 2px; }
        .thumbnail {
            display: inline-flex; flex-direction: column;
            min-width: 35vw; cursor: pointer; border-radius: var(--radius);
            overflow: hidden;
        }
        .thumbnail .image-container { aspect-ratio: 9/16; position: relative; }
        .thumbnail img { width: 100%; height: 100%; object-fit: cover; border-radius: var(--radius); }
        .thumbnail .title {
            font-size: 0.8rem; text-align: center; padding: 6px 0;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* More Files Section */
        .more-files {
            margin: 15px 12px;
        }
        .more-files h2 { font-size: 1rem; margin-bottom: 10px; }
        .vertical-scroll {
            display: flex; flex-direction: column; gap: var(--gap);
            overflow-y: auto; padding-bottom: 20px; overflow: visible;
        }
        .vertical-scroll .thumbnail {
            min-width: unset; width: 90vw; margin: 0 auto;
        }
        .vertical-scroll .image-container { aspect-ratio: 16/9; }
        .vertical-scroll::-webkit-scrollbar { width: 4px; }
        .vertical-scroll::-webkit-scrollbar-thumb { background: #555; border-radius: 2px; }

        /* Detail Overlay */
        #detail-page {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; flex-direction: column; align-items: center;
            justify-content: center; padding: 20px; z-index: 200;
        }
        #detail-page.open { display: flex; }
        #detail-content {
            background: var(--bg); padding: 20px; border-radius: var(--radius);
            max-width: 90%; width: 350px; text-align: center;
        }
        #detail-content img { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: var(--radius); margin-bottom: 12px; }
        .btn {
            margin-top: 10px; padding: 6px 12px; border: none;
            background: var(--accent); color: var(--fg); border-radius: var(--radius);
            cursor: pointer; font-size: 0.8rem;
        }
        .btn.secondary { background: transparent; border: 1px solid var(--fg); }
        #timer { margin-top: 6px; font-size: 0.8rem; }

        /* Search Overlay */
        #search-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; flex-direction: column; padding: 20px; z-index: 150;
        }
        #search-overlay.open { display: flex; }
        #search-overlay input {
            padding: 6px; margin-bottom: 12px; border: none;
            background: #333; color: var(--fg); border-radius: var(--radius);
            font-size: 0.8rem;
        }
        #search-results {
            flex: 1; overflow-y: auto; display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: var(--gap);
        }
        #search-results .thumbnail { width: 100%; }
        #search-results .image-container { aspect-ratio: 16/9; }
    </style>
</head>
<body>
    <header>
        <div class="logo">Prime Video</div>
        <div class="search">
            <button class="search-btn">üîç</button>
        </div>
    </header>

    <section class="hero" id="hero-slider">
        <div class="track">
            {% for v in videos %}
            <div class="hero-slide" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
                <div class="image-container">
                    <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
                    <button class="watch-now">Watch Now</button>
                </div>
                <div class="hero-content">
                    <h1>{{ v.title }}</h1>
                    <p>Watch this exciting content now!</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <section class="content-section">
        <h2>Latest</h2>
        <div class="scroll-container" id="latest-slider">
            {% for v in videos %}
            <div class="thumbnail" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
                <div class="image-container">
                    <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
                </div>
                <div class="title">{{ v.title }}</div>
            </div>
            {% endfor %}
        </div>
    </section>

    <section class="content-section">
        <h2>All Movies</h2>
        <div class="scroll-container" id="all-movies-slider">
            {% for v in videos %}
            <div class="thumbnail" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
                <div class="image-container">
                    <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
                </div>
                <div class="title">{{ v.title }}</div>
            </div>
            {% endfor %}
        </div>
    </section>

    <section class="more-files">
        <h2>More Files</h2>
        <div class="vertical-scroll" id="more-files-slider">
            {% for v in videos %}
            <div class="thumbnail" data-thumb="{{ v.thumbnail_url }}" data-title="{{ v.title }}" data-key="{{ v.custom_key }}">
                <div class="image-container">
                    <img src="{{ v.thumbnail_url }}" alt="{{ v.title }}">
                </div>
                <div class="title">{{ v.title }}</div>
            </div>
            {% endfor %}
        </div>
    </section>

    <div id="detail-page">
        <div id="detail-content">
            <img id="detail-thumb" src="" alt="">
            <h2 id="detail-title"></h2>
            <button class="btn" id="get-file">Get File</button>
            <div id="timer"></div>
            <button class="btn" id="open-link" style="display:none;">Open File</button>
            <button class="btn secondary" id="close-detail">Close</button>
        </div>
    </div>

    <div id="search-overlay">
        <input type="text" id="overlay-search" placeholder="Search by title...">
        <div id="search-results"></div>
        <button class="btn secondary" id="close-search">Close</button>
    </div>

    <script>
        const BOT_USERNAME = '{{ bot_username }}';

        // Collect video data
        const videos = Array.from(document.querySelectorAll('.hero-slide, .thumbnail')).map(item => ({
            thumb: item.getAttribute('data-thumb'),
            title: item.getAttribute('data-title'),
            key: item.getAttribute('data-key')
        }));

        // Hero Slider Auto-scroll
        let idx = 0;
        const heroTrack = document.querySelector('.hero .track');
        const heroSlides = document.querySelectorAll('.hero-slide');
        function showHero(i) {
            idx = (i + heroSlides.length) % heroSlides.length;
            heroTrack.style.transform = `translateX(-${idx * 100}%)`;
        }
        const autoScroll = setInterval(() => showHero(idx + 1), 5000);

        // Shuffle All Movies Slider
        function shuffleSlider(id) {
            const slider = document.getElementById(id);
            const items = Array.from(slider.children);
            for (let i = items.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                slider.appendChild(items[j]);
            }
        }
        document.addEventListener('DOMContentLoaded', () => shuffleSlider('all-movies-slider'));

        // Thumbnail Click
        document.body.addEventListener('click', e => {
            const item = e.target.closest('.hero-slide, .thumbnail, .watch-now');
            if (!item) return;
            const thumb = item.getAttribute('data-thumb');
            const title = item.getAttribute('data-title');
            const key = item.getAttribute('data-key');
            document.getElementById('detail-thumb').src = thumb;
            document.getElementById('detail-title').textContent = title;
            document.getElementById('get-file').style.display = 'inline-block';
            document.getElementById('open-link').style.display = 'none';
            document.getElementById('get-file').disabled = false;
            document.getElementById('timer').textContent = '';
            document.getElementById('get-file').onclick = () => startTimer(key);
            document.getElementById('detail-page').classList.add('open');
        });

        // Close Detail
        document.getElementById('close-detail').onclick = () => {
            document.getElementById('detail-page').classList.remove('open');
        };

        // Timer for Telegram Link
        function startTimer(key) {
            const btn = document.getElementById('get-file');
            const link = document.getElementById('open-link');
            const timerEl = document.getElementById('timer');
            btn.disabled = true;
            let c = 5;
            timerEl.textContent = `Wait ${c}s...`;
            const iv = setInterval(() => {
                c--;
                if (c <= 0) {
                    clearInterval(iv);
                    btn.style.display = 'none';
                    link.style.display = 'block';
                    timerEl.textContent = '';
                    link.onclick = () => window.open(`https://t.me/${BOT_USERNAME}?start=${key}`, '_blank');
                } else {
                    timerEl.textContent = `Wait ${c}s...`;
                }
            }, 1000);
        }

        // Search Functionality
        document.querySelector('.search-btn').onclick = () => {
            document.getElementById('search-overlay').classList.add('open');
            document.getElementById('overlay-search').focus();
        };
        document.getElementById('close-search').onclick = () => {
            document.getElementById('search-overlay').classList.remove('open');
            document.getElementById('overlay-search').value = '';
            document.getElementById('search-results').innerHTML = '';
        };
        document.getElementById('overlay-search').oninput = () => {
            const term = document.getElementById('overlay-search').value.toLowerCase();
            const results = videos.filter(v => v.title.toLowerCase().includes(term));
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';
            results.forEach(v => {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'thumbnail';
                thumbnail.setAttribute('data-thumb', v.thumb);
                thumbnail.setAttribute('data-title', v.title);
                thumbnail.setAttribute('data-key', v.key);
                thumbnail.innerHTML = `
                    <div class="image-container">
                        <img src="${v.thumb}" alt="${v.title}">
                    </div>
                    <div class="title">${v.title}</div>
                `;
                resultsContainer.appendChild(thumbnail);
            });
        };
    </script>
</body>
</html>
